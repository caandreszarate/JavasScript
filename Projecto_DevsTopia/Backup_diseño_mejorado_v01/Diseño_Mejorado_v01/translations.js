// Sistema de traducciones para DevsTopia
const translations = {
    es: {
        // Navegación
        nav: {
            inicio: "Inicio",
            servicios: "Servicios",
            portafolio: "Portafolio",
            contacto: "Contacto"
        },
        
        // Hero Section
        hero: {
            title: "Desarrollo de Software",
            subtitle: "Transformamos ideas en soluciones digitales",
            btnServicios: "Servicios",
            btnCotizar: "Cotizar"
        },
        
        // Secciones
        sections: {
            servicios: "Servicios",
            portafolio: "Portafolio",
            contacto: "Contacto"
        },
        
        // Portafolio
        portafolio: {
            ecommerce: {
                titulo: "Plataforma E-commerce",
                descripcion: "Plataforma de comercio electrónico completa con gestión de inventario y pagos."
            },
            delivery: {
                titulo: "App de Delivery",
                descripcion: "Aplicación móvil para entrega de alimentos con geolocalización."
            },
            erp: {
                titulo: "Sistema de Gestión ERP",
                descripcion: "Software empresarial para gestión integral de recursos."
            },
            dashboard: {
                titulo: "Dashboard Analytics",
                descripcion: "Panel de control con análisis de datos en tiempo real."
            },
            fitness: {
                titulo: "App de Fitness",
                descripcion: "Aplicación para seguimiento de rutinas y nutrición."
            },
            facturacion: {
                titulo: "Sistema de Facturación",
                descripcion: "Software para gestión de facturas y contabilidad."
            }
        },
        
        // Servicios
        servicios: {
            desarrolloSoftware: {
                nombre: "Desarrollo de Software a Medida",
                descripcion: "Soluciones personalizadas según las necesidades del cliente."
            },
            desarrolloWeb: {
                nombre: "Diseño y Desarrollo Web",
                descripcion: "Para empresas que necesitan presencia digital profesional."
            },
            aplicacionesMoviles: {
                nombre: "Aplicaciones Móviles",
                descripcion: "Desarrollo de apps eficientes, modernas y con enfoque en experiencia de usuario."
            },
            automatizacion: {
                nombre: "Automatización y Procesos Inteligentes",
                descripcion: "Aumentar eficiencia y reducir tareas manuales."
            },
            cloudDevops: {
                nombre: "Servicios en la Nube & DevOps",
                descripcion: "Escalabilidad, seguridad y rendimiento garantizado."
            },
            ciberseguridad: {
                nombre: "Ciberseguridad y Protección de Datos",
                descripcion: "Asegura el software y los datos del cliente."
            },
            analisisDatos: {
                nombre: "Análisis de Datos e Inteligencia Artificial",
                descripcion: "Toma de decisiones con base en datos."
            },
            qaTesting: {
                nombre: "QA y Testing",
                descripcion: "Asegura la calidad de cada entrega."
            },
            soporte: {
                nombre: "Soporte Técnico y Mantenimiento",
                descripcion: "Para que el cliente esté tranquilo después de la entrega."
            },
            consultoria: {
                nombre: "Consultoría y Transformación Digital",
                descripcion: "Para empresas que no saben por dónde empezar."
            }
        },
        
        // Contacto
        contacto: {
            email: "Email",
            telefono: "Teléfono",
            ubicacion: "Ubicación",
            nombre: "Nombre",
            mensaje: "Mensaje",
            enviar: "Enviar"
        },
        
        // Modal
        modal: {
            cotizacion: "Cotización",
            nombre: "Nombre",
            servicio: "Servicio",
            descripcion: "Descripción del proyecto",
            seleccionarServicio: "Selecciona un servicio",
            desarrolloWeb: "Desarrollo Web",
            appMovil: "Aplicación Móvil",
            softwareMedida: "Software a Medida",
            consultoria: "Consultoría",
            otros: "Otros"
        },
        
        // Chat
        chat: {
            titulo: "Chat",
            placeholder: "Escribe tu mensaje...",
            mensajeInicial: "¿En qué podemos ayudarte?"
        },
        
        // Footer
        footer: {
            descripcion: "Transformamos ideas en soluciones digitales.",
            servicios: "Servicios",
            desarrolloWeb: "Desarrollo Web",
            appsMoviles: "Apps Móviles",
            softwareMedida: "Software a Medida",
            consultoria: "Consultoría",
            contacto: "Contacto",
            derechos: "Todos los derechos reservados."
        }
    },
    
    en: {
        // Navigation
        nav: {
            inicio: "Home",
            servicios: "Services",
            portafolio: "Portfolio",
            contacto: "Contact"
        },
        
        // Hero Section
        hero: {
            title: "Software Development",
            subtitle: "We transform ideas into digital solutions",
            btnServicios: "Services",
            btnCotizar: "Quote"
        },
        
        // Sections
        sections: {
            servicios: "Services",
            portafolio: "Portfolio",
            contacto: "Contact"
        },
        
        // Portfolio
        portafolio: {
            ecommerce: {
                titulo: "E-commerce Platform",
                descripcion: "Complete e-commerce platform with inventory and payment management."
            },
            delivery: {
                titulo: "Delivery App",
                descripcion: "Mobile application for food delivery with geolocation."
            },
            erp: {
                titulo: "ERP Management System",
                descripcion: "Enterprise software for comprehensive resource management."
            },
            dashboard: {
                titulo: "Dashboard Analytics",
                descripcion: "Control panel with real-time data analysis."
            },
            fitness: {
                titulo: "Fitness App",
                descripcion: "Application for routine and nutrition tracking."
            },
            facturacion: {
                titulo: "Billing System",
                descripcion: "Software for invoice and accounting management."
            }
        },
        
        // Services
        servicios: {
            desarrolloSoftware: {
                nombre: "Custom Software Development",
                descripcion: "Personalized solutions according to client needs."
            },
            desarrolloWeb: {
                nombre: "Web Design & Development",
                descripcion: "For companies that need professional digital presence."
            },
            aplicacionesMoviles: {
                nombre: "Mobile Applications",
                descripcion: "Development of efficient, modern apps with focus on user experience."
            },
            automatizacion: {
                nombre: "Automation & Intelligent Processes",
                descripcion: "Increase efficiency and reduce manual tasks."
            },
            cloudDevops: {
                nombre: "Cloud Services & DevOps",
                descripcion: "Guaranteed scalability, security and performance."
            },
            ciberseguridad: {
                nombre: "Cybersecurity & Data Protection",
                descripcion: "Secures client software and data."
            },
            analisisDatos: {
                nombre: "Data Analysis & Artificial Intelligence",
                descripcion: "Data-driven decision making."
            },
            qaTesting: {
                nombre: "QA & Testing",
                descripcion: "Ensures quality in every delivery."
            },
            soporte: {
                nombre: "Technical Support & Maintenance",
                descripcion: "So the client can be at peace after delivery."
            },
            consultoria: {
                nombre: "Consulting & Digital Transformation",
                descripcion: "For companies that don't know where to start."
            }
        },
        
        // Contact
        contacto: {
            email: "Email",
            telefono: "Phone",
            ubicacion: "Location",
            nombre: "Name",
            mensaje: "Message",
            enviar: "Send"
        },
        
        // Modal
        modal: {
            cotizacion: "Quote",
            nombre: "Name",
            servicio: "Service",
            descripcion: "Project description",
            seleccionarServicio: "Select a service",
            desarrolloWeb: "Web Development",
            appMovil: "Mobile App",
            softwareMedida: "Custom Software",
            consultoria: "Consulting",
            otros: "Others"
        },
        
        // Chat
        chat: {
            titulo: "Chat",
            placeholder: "Write your message...",
            mensajeInicial: "How can we help you?"
        },
        
        // Footer
        footer: {
            descripcion: "We transform ideas into digital solutions.",
            servicios: "Services",
            desarrolloWeb: "Web Development",
            appsMoviles: "Mobile Apps",
            softwareMedida: "Custom Software",
            consultoria: "Consulting",
            contacto: "Contact",
            derechos: "All rights reserved."
        }
    }
};

// Función para cambiar idioma
function changeLanguage(lang) {
    const currentLang = lang || 'es';
    const langData = translations[currentLang];
    
    console.log('Cambiando idioma a:', currentLang);
    console.log('Datos de idioma:', langData);
    
    // Actualizar navegación
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const keys = key.split('.');
        let value = langData;
        
        console.log('Procesando elemento:', element, 'con clave:', key);
        
        for (const k of keys) {
            value = value[k];
        }
        
        if (value) {
            element.textContent = value;
            console.log('Traducido:', key, '->', value);
        } else {
            console.warn('No se encontró traducción para:', key);
        }
    });
    
    // Actualizar placeholders
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        const keys = key.split('.');
        let value = langData;
        
        for (const k of keys) {
            value = value[k];
        }
        
        if (value) {
            element.placeholder = value;
        }
    });
    
    // Actualizar opciones de select
    document.querySelectorAll('option[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const keys = key.split('.');
        let value = langData;
        
        for (const k of keys) {
            value = value[k];
        }
        
        if (value) {
            element.textContent = value;
        }
    });
    
    // Actualizar botón de idioma
    const langToggle = document.getElementById('language-toggle');
    if (langToggle) {
        langToggle.querySelector('.lang-text').textContent = currentLang.toUpperCase();
    }
    
    // Guardar preferencia
    localStorage.setItem('devstopia-language', currentLang);
    
    // Actualizar chat
    updateChatLanguage(currentLang);
    
    // Recargar contenido dinámico
    setTimeout(() => {
        if (typeof loadServices === 'function') {
            console.log('Recargando servicios...');
            loadServices();
        }
        if (typeof loadPortfolio === 'function') {
            console.log('Recargando portafolio...');
            loadPortfolio();
        }
        
        // Forzar actualización de elementos estáticos
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.getAttribute('data-translate');
            const keys = key.split('.');
            let value = langData;
            
            for (const k of keys) {
                value = value[k];
            }
            
            if (value) {
                element.textContent = value;
            }
        });
    }, 50);
    
    console.log('Idioma cambiado exitosamente a:', currentLang);
}

// Función para actualizar idioma del chat
function updateChatLanguage(lang) {
    const chatMessages = document.getElementById('chat-messages');
    if (chatMessages) {
        const initialMessage = chatMessages.querySelector('.message.bot p');
        if (initialMessage) {
            initialMessage.textContent = translations[lang].chat.mensajeInicial;
        }
    }
    
    const chatInput = document.getElementById('chat-input');
    if (chatInput) {
        chatInput.placeholder = translations[lang].chat.placeholder;
    }
}

// Función para obtener idioma actual
function getCurrentLanguage() {
    return localStorage.getItem('devstopia-language') || 'es';
}

// Función para inicializar idioma
function initializeLanguage() {
    console.log('Inicializando sistema de traducciones...');
    
    const currentLang = getCurrentLanguage();
    console.log('Idioma actual:', currentLang);
    
    // Esperar a que el DOM esté completamente cargado
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            debugTranslationElements();
            debugTranslations();
            changeLanguage(currentLang);
        });
    } else {
        debugTranslationElements();
        debugTranslations();
        changeLanguage(currentLang);
    }
    
    // Configurar evento del botón de idioma
    const langToggle = document.getElementById('language-toggle');
    if (langToggle) {
        langToggle.addEventListener('click', () => {
            const currentLang = getCurrentLanguage();
            const newLang = currentLang === 'es' ? 'en' : 'es';
            console.log('Cambiando de', currentLang, 'a', newLang);
            changeLanguage(newLang);
        });
    }
    
    console.log('Sistema de traducciones inicializado');
}

// Función de debug para verificar elementos traducibles
function debugTranslationElements() {
    console.log('=== DEBUG: Elementos con data-translate ===');
    const elements = document.querySelectorAll('[data-translate]');
    console.log('Total de elementos encontrados:', elements.length);
    
    elements.forEach((element, index) => {
        const key = element.getAttribute('data-translate');
        console.log(`${index + 1}. Elemento:`, element.tagName, 'Clave:', key, 'Texto actual:', element.textContent);
    });
    
    console.log('=== FIN DEBUG ===');
}

// Función de debug para verificar traducciones disponibles
function debugTranslations() {
    const currentLang = getCurrentLanguage();
    const langData = window.translations ? window.translations[currentLang] : null;
    
    console.log('=== DEBUG: Traducciones Disponibles ===');
    console.log('Idioma actual:', currentLang);
    console.log('Datos de idioma:', langData);
    
    if (langData && langData.servicios) {
        console.log('Servicios disponibles:', Object.keys(langData.servicios));
    }
    
    if (langData && langData.portafolio) {
        console.log('Portafolio disponible:', Object.keys(langData.portafolio));
    }
    
    console.log('=== FIN DEBUG ===');
}

// Exportar funciones
window.changeLanguage = changeLanguage;
window.getCurrentLanguage = getCurrentLanguage;
window.initializeLanguage = initializeLanguage;
window.debugTranslationElements = debugTranslationElements;
window.debugTranslations = debugTranslations;
window.translations = translations; 